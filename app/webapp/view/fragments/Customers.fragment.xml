<core:FragmentDefinition
    xmlns:core="sap.ui.core"
    xmlns="sap.m"
    xmlns:f="sap.ui.layout.form"
    xmlns:mdc="sap.ui.mdc"
    xmlns:table="sap.ui.mdc.table"
    xmlns:mdct="sap.ui.mdc.table"
    xmlns:mdcvh="sap.ui.mdc.valuehelp"
    xmlns:mdcvc="sap.ui.mdc.valuehelp.content"
    xmlns:layout="sap.f">
    <layout:DynamicPage
        id="customerDynamicPage"
        fitContent="false"
        preserveHeaderStateOnScroll="false"
        headerExpanded="true"
        toggleHeaderOnTitleClick="false">
        
        <!-- Optional Page Title -->
        <layout:title>
            <layout:DynamicPageTitle>
                <layout:heading>
                    <Title text="Customer Management" level="H2" />
                </layout:heading>
            </layout:DynamicPageTitle>
        </layout:title>
        
        <!-- ========== FILTERBAR ========== -->
        <layout:header>
            <layout:DynamicPageHeader pinnable="false">
    <VBox class="sapUiTinyMargin">
   <mdc:FilterBar
    id="customerFilterBar"
    showGoButton="true"
    showAdaptFiltersButton="true"
    p13nMode="Item,Value"
    filterConditions="{filterModel>/Customers/conditions}"
    delegate="{
                            'name': 'glassboard/delegate/CustomersFilterBarDelegate',
                            'payload': { 'collectionPath': 'Customers' }
                        }"
>
    <mdc:filterItems>
        <!-- =============================================== -->
        <!--      CUSTOMER NAME (FILTERFIELD + VALUE HELP)  -->
        <!-- =============================================== -->
        <mdc:FilterField
            id="filterCustomerName"
            label="Customer Name"
            width="250px"
            propertyKey="customerName"
            display="Description"
            editMode="Editable"
            valueHelp="vhCustomerName"
            conditions="{filterModel>/Customers/conditions/customerName}"
        >
            <mdc:dependents>
                <mdc:ValueHelp
                    id="vhCustomerName"
                    delegate="{
                                            name: 'glassboard/delegate/SearchValueHelpDelegate',
                                            payload: { searchKeys: ['customerName', 'vertical'] }
                                        }"
                >
                    <!-- TYPEAHEAD -->
                    <mdc:typeahead>
                             <mdcvh:Popover title="Select Customer">
                                                <mdcvc:MTable
                                                    keyPath="customerName"
                                                    descriptionPath="customerName">

                                                    <Table
                                                        id="tblCustomerTypeahead"
                                                        width="22rem"
                                                        mode="MultiSelect"
                                                        items="{ path: '/Customers' }">

                                                        <columns>
                                                            <Column><Text text="Customer Name" /></Column>
                                                            <Column><Text text="Vertical" /></Column>
                                                        </columns>

                                                        <items>
                                                            <ColumnListItem>
                                                                <Text text="{customerName}" />
                                                                <Text text="{vertical}" />
                                                            </ColumnListItem>
                                                        </items>

                                                    </Table>
                                                </mdcvc:MTable>
                                            </mdcvh:Popover>
                                        </mdc:typeahead>

                    <!-- DIALOG -->
                    <mdc:dialog>
                        <mdcvh:Dialog id="dlgCustomerVH" title="Select Customer">
                            <mdcvc:MDCTable keyPath="customerName" descriptionPath="customerName">
                                <!-- DIALOG FILTER BAR -->
                                <!-- <mdcvc:filterBar>
                                    <mdcvh:FilterBar
                                        id="fbCustomerVH"
                                        showGoButton="true"
                                        liveMode="false"
                                        filterConditions="{filterModel>/Customers/conditions}"
                                        delegate="{
                                                                name: 'glassboard/delegate/CustomersFilterBarDelegate',
                                                                payload: { collectionPath: 'Customers' }
                                                            }"
                                    >
                                    </mdcvh:FilterBar>
                                </mdcvc:filterBar> -->

                                <!-- DIALOG TABLE -->
                                <mdc:Table
                                    id="tblCustomerVH"
                                    autoBindOnInit="true"
                                    width="100%"
                                    selectionMode="Multi"
                                    p13nMode="Column,Sort"
                                    enableAutoColumnWidth="true"
                                    threshold="20"
                                    filter="customerFilterBar"
                                    filterConditions="{filterModel>/Customers/conditions}"
                                    delegate="{
        name: 'glassboard/delegate/CustomersTableDelegate',
        payload: {
            collectionPath: 'Customers',
            searchKeys: ['customerName','vertical']
        }
    }"
                                >
                                    <mdc:type>
                                        <table:GridTableType rowCountMode="Auto" />
                                    </mdc:type>

                                    <!-- ************* FIX: ADD COLUMNS HERE ************* -->
                                    <mdc:columns>
                                        <mdct:Column
                                            id="VHcolCustName"
                                            header="Customer Name"
                                            propertyKey="customerName"
                                        >
                                            <Text text="{customerName}" />
                                        </mdct:Column>

                                        <mdct:Column id="VHcolVertical" header="Vertical" propertyKey="vertical">
                                            <Text text="{vertical}" />
                                        </mdct:Column>
                                    </mdc:columns>
                                </mdc:Table>
                            </mdcvc:MDCTable>
                        </mdcvh:Dialog>
                    </mdc:dialog>
                </mdc:ValueHelp>
            </mdc:dependents>
        </mdc:FilterField>

        <!-- ===========================
                                 VERTICAL FILTER
                             =========================== -->
<!-- ===========================
     VERTICAL FILTER - EXACT SAME BEHAVIOR AS CUSTOMER NAME
     =========================== -->
<mdc:FilterField
    id="filterVertical"
    label="Vertical"
    width="250px"
    propertyKey="vertical"
    display="Description"
    editMode="Editable"
    valueHelp="vhVertical"
    maxConditions="-1"
    conditions="{filterModel>/Customers/conditions/vertical}"
>
    <mdc:dependents>
        <mdc:ValueHelp
            id="vhVertical"
            delegate="{
                name: 'glassboard/delegate/SearchValueHelpDelegate',
                payload: { searchKeys: ['vertical', 'customerName'] }
            }"
        >
            <!-- DIALOG - exactly like the Customer Name one -->
            <mdc:dialog>
                <mdcvh:Dialog id="dlgVerticalVH" title="Select Vertical">
                    <mdcvc:MDCTable 
                        keyPath="vertical" 
                        descriptionPath="vertical"
                    >
                        <mdc:Table
                            id="tblVerticalVH"
                            autoBindOnInit="true"
                            width="100%"
                            selectionMode="Multi"
                            p13nMode="Column,Sort"
                            enableAutoColumnWidth="true"
                            threshold="20"
                            filter="customerFilterBar"
                            filterConditions="{filterModel>/Customers/conditions}"
                            delegate="{
                                name: 'glassboard/delegate/CustomersTableDelegate',
                                payload: {
                                    collectionPath: 'Customers',
                                    searchKeys: ['vertical','customerName']
                                }
                            }"
                        >
                            <mdc:type>
                                <table:GridTableType rowCountMode="Auto" />
                            </mdc:type>

                            <!-- SAME TWO COLUMNS AS IN CUSTOMER NAME DIALOG -->
                            <mdc:columns>
                                <mdct:Column
                                    id="VHcolVertical1"
                                    header="Vertical"
                                    propertyKey="vertical"
                                >
                                    <Text text="{vertical}" />
                                </mdct:Column>

                                <mdct:Column 
                                    id="VHcolCustName1"
                                    header="Customer Name" 
                                    propertyKey="customerName"
                                >
                                    <Text text="{customerName}" />
                                </mdct:Column>
                            </mdc:columns>
                        </mdc:Table>
                    </mdcvc:MDCTable>
                </mdcvh:Dialog>
            </mdc:dialog>
        </mdc:ValueHelp>
    </mdc:dependents>
</mdc:FilterField>
    </mdc:filterItems>
</mdc:FilterBar>

                </VBox>
            </layout:DynamicPageHeader>
        </layout:header>
        
        <!-- ========== MAIN CONTENT ========== -->
        <layout:content>
            <VBox class="sapUiSmallMargin">
                <!-- ===== TABLE PANEL ===== -->
                <Panel class="sapUiResponsiveMargin" expandable="false">
            <Toolbar>
                <ToolbarSpacer />
                <SearchField
                    id="customerSearchField"
                    width="300px"
                    placeholder="Search customers..."
                    liveChange="onCustomerSearch"
                    search="onCustomerSearch" />
            </Toolbar>
                    <ScrollContainer height="220px" vertical="true" horizontal="false">
                <mdc:Table
                    id="Customers"
                            header="Customers"
                    class="verticalsTable rowDetailToggleTable"
                    autoBindOnInit="false"
                    busyIndicatorDelay="0"
                    width="100%"
                    p13nMode="Column,Sort,Filter,Group"
                    selectionMode="Single"
                    delegate='{
                        "name": "glassboard/delegate/CustomersTableDelegate",
                        "payload": {
                            "collectionPath": "Customers"
                        }
                    }'
                    showRowCount="true"
                    threshold="20"
                    enableExport="true"
                    enableAutoColumnWidth="false"
                    filter="customerFilterBar"
                            filterConditions="{filterModel>/Customers/conditions}"
                    selectionChange="onSelectionChange">
                            <mdc:type>
                                <table:ResponsiveTableType />
                            </mdc:type>
                    <mdc:actions>
                                <SegmentedButton
                                    selectedKey="less"
                                    selectionChange="onToggleRowDetail"
                                    tooltip="Toggle Row Details">
                            <items>
                                <SegmentedButtonItem key="more" icon="sap-icon://detail-more" tooltip="Show More" />
                                <SegmentedButtonItem key="less" icon="sap-icon://detail-less" tooltip="Show Less" />
                            </items>
                        </SegmentedButton>
                        <Button icon="sap-icon://delete" id="btnDelete_cus" tooltip="Delete" press="onDeletePress" enabled="false" />
                        <SplitButton id="customerUpload" icon="sap-icon://upload" tooltip="Upload" type="Transparent" press="onUpload" arrowPress="onSplitButtonArrowPress" />
                    </mdc:actions>
                </mdc:Table>
                    </ScrollContainer>
        </Panel>
                
                <!-- ===== SPACE BETWEEN TABLE AND FORM ===== -->
        <HBox width="100%" class="extraSpace"><ToolbarSpacer /></HBox>
                
                <!-- ===== FORM PANEL ===== -->
        <Panel headerText="Customer Details" class="sapUiResponsiveMargin" expandable="false">
                    <headerToolbar>
                        <Toolbar>
                            <Title text="Customer Details" level="H2" />
                            <ToolbarSpacer />
                            <Button id="editButton_cus" text="Edit" type="Emphasized" press="onEditCustomerForm" enabled="false" class="sapUiSmallMarginEnd" />
                            <Button id="submitButton_cus" text="Submit" type="Accept" press="onSubmitCustomer" />
                            <Button id="cancelFormButton_cus" text="Cancel" type="Reject" press="onCancelForm" class="sapUiSmallMarginBegin" />
                        </Toolbar>
                    </headerToolbar>
            <VBox class="sapUiSmallMargin">
                <HBox width="100%">
                    <!-- Left Column -->
                    <VBox width="50%" class="sapUiSmallMarginEnd">
                        <f:SimpleForm
                            layout="ResponsiveGridLayout"
                            editable="true"
                            labelSpanL="3"
                            labelSpanM="3"
                            adjustLabelSpan="false"
                            emptySpanL="1"
                            emptySpanM="1"
                            columnsL="1"
                            columnsM="1"
                            class="sapUiNoContentPadding">
                            <Label text="Customer ID" />
                            <Input id="inputCustomerId" value="{customerModel>/SAPcustId}" width="100%" enabled="false" placeholder="Auto-generated" visible="false" />
                            <Label text="Customer Name" required="true" />
                            <Input id="inputCustomerName" value="{customerModel>/customerName}" width="100%" required="true" />
                            <!-- COUNTRY -->
                            <Label text="Country" required="true" />
                            <ComboBox
                                id="countryComboBox"
                                selectedKey="{customerModel>/custCountryId}"
                                selectionChange="onCountryChange"
                                width="100%"
                                showClearIcon="true"
                                
                                items="{
                                    path: 'default>/CustomerCountries',
                                    sorter: [{ path: 'name' }],
                                     length: 300
                                }"
                            >
                                <core:ListItem key="{default>id}" text="{default>name}" />
                            </ComboBox>
                            <!-- STATE -->
                            <Label text="State" />
                            <ComboBox
                                id="stateComboBox"
                                selectedKey="{customerModel>/custStateId}"
                                selectionChange="onStateChange"
                                width="100%"
                                showClearIcon="true"
                                enabled="false"
                                  items="{
                                    path: 'default>/CustomerStates',
                                    sorter: [{ path: 'name' }],
                                    length:2000
                                     
                                }"
                                

                            >
                                <core:ListItem key="" text="Select State..." />
                            </ComboBox>
                            <!-- CITY -->
                            <Label text="City" />
                            <ComboBox
                                id="cityComboBox"
                                selectedKey="{customerModel>/custCityId}"
                                selectionChange="onCityChange"
                                width="100%"
                                showClearIcon="true"
                                enabled="false"
                                 items="{
                                    path: 'default>/CustomerCities',
                                    sorter: [{ path: 'name' }],
                                    length:50000
                                }"
                            >
                                <core:ListItem key="" text="Select City..." />
                            </ComboBox>
                        </f:SimpleForm>
                    </VBox>
                    
                    <!-- Right Column -->
                    <VBox width="50%" class="sapUiSmallMarginBegin">
                        <f:SimpleForm
                            layout="ResponsiveGridLayout"
                            editable="true"
                            labelSpanL="3"
                            labelSpanM="3"
                            adjustLabelSpan="false"
                            emptySpanL="1"
                            emptySpanM="1"
                            columnsL="1"
                            columnsM="1"
                            class="sapUiNoContentPadding">
                        
                            <Label text="Vertical" required="true" />
                            <Select id="inputVertical" selectedKey="{customerModel>/vertical}" width="100%" required="true">
                                <items>
                                    <core:Item key="" text="Select Vertical..." />
                                    <core:Item key="BFS" text="BFS" />
                                    <core:Item key="CapitalMarkets" text="Capital Markets" />
                                    <core:Item key="CPG" text="CPG" />
                                    <core:Item key="Healthcare" text="Healthcare" />
                                    <core:Item key="HighTech" text="High Tech" />
                                    <core:Item key="Insurance" text="Insurance" />
                                    <core:Item key="LifeSciences" text="Life Sciences" />
                                    <core:Item key="Manufacturing" text="Manufacturing" />
                                    <core:Item key="Retail" text="Retail" />
                                    <core:Item key="Services" text="Services" />
                                </items>
                            </Select>
                            <Label text="Start Date" />
                            <DatePicker id="inputStartDate_cus" value="{customerModel>/startDate}" valueFormat="yyyy-MM-dd" displayFormat="short" width="100%" />
                            <Label text="End Date" />
                            <DatePicker id="inputEndDate_cus" value="{customerModel>/endDate}" valueFormat="yyyy-MM-dd" displayFormat="short" width="100%" />
                                <Label text="Status" required="true" />
                            <Select id="inputStatus" selectedKey="{customerModel>/status}" width="100%" required="true">
                                <items>
                                    <core:Item key="" text="Select Status..." />
                                    <core:Item key="Active" text="Active" />
                                    <core:Item key="Inactive" text="Inactive" />
                                    <core:Item key="Prospect" text="Prospect" />
                                </items>
                            </Select>
                        </f:SimpleForm>
                    </VBox>
                </HBox>
            
            </VBox>
        </Panel>
    </VBox>
        </layout:content>
    </layout:DynamicPage>
</core:FragmentDefinition>