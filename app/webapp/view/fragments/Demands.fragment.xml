<core:FragmentDefinition xmlns:core="sap.ui.core"
                         xmlns="sap.m"
                         xmlns:f="sap.ui.layout.form"
                         xmlns:mdc="sap.ui.mdc"
                         xmlns:mdct="sap.ui.mdc.table">
    <VBox class="sapUiSmallMargin">
        <!-- Panel for Table -->
        <Panel class="sapUiResponsiveMargin" expandable="false">
            <Toolbar>
                <Select
                    id="demandViewSelect"
                    selectedKey="projects"
                    change="onSelection">
                    <core:Item key="employees" text="Employees" />
                    <core:Item key="projects" text="Projects" />
                </Select>
                <ToolbarSpacer />
                <SearchField
                    id="demandSearchField"
                    width="300px"
                    placeholder="Search demands..."
                    liveChange="onDemandSearch"
                    search="onDemandSearch" />                                 
            </Toolbar>
            <ScrollContainer height="220px" vertical="true" horizontal="false">
                <mdc:Table
                    id="Demands"
                    header="Demands"
                    class="verticalsTable rowDetailToggleTable"
                    autoBindOnInit="false"
                    busyIndicatorDelay="0"
                    width="100%"
                    p13nMode="Column,Sort,Filter,Group"
                    selectionMode="Single"
                    delegate='{
                        "name": "glassboard/delegate/DemandsTableDelegate",
                        "payload": {
                            "collectionPath": "Demands"
                        }
                    }'
                    showRowCount="true"
                    threshold="1000"
                    enableExport="true"
                    enableAutoColumnWidth="false"
                    selectionChange="onSelectionChange">

                    <mdc:type>
                        <mdct:ResponsiveTableType />
                    </mdc:type>

                    <mdc:actions>
                        <SegmentedButton 
                            selectedKey="less"
                            selectionChange="onToggleRowDetail"
                            tooltip="Toggle Row Details">
                            <items>
                                <SegmentedButtonItem key="more" icon="sap-icon://detail-more" tooltip="Show More"/>
                                <SegmentedButtonItem key="less" icon="sap-icon://detail-less" tooltip="Show Less"/>
                            </items>
                        </SegmentedButton>
                        <Button icon="sap-icon://delete" id="btnDelete_demand" tooltip="Delete" press="onDeletePress" enabled="false" />
                        <Button text="Find Resources" id="Resources_demand" press="onResourcesPress" enabled="false"/>
                        <Button text="Back" id="btnBack_Alloc" press="onBackToProjectsPress" />
                        <SplitButton
                            id="demandUpload"
                            icon="sap-icon://upload"
                            tooltip="Upload"
                            type="Transparent"
                            press="onUpload"
                            arrowPress="onSplitButtonArrowPress"
                        />
                    </mdc:actions>
                </mdc:Table>
            </ScrollContainer>
        </Panel>
        <HBox width="100%" class="extraSpace"><ToolbarSpacer /></HBox>

        <!-- Panel for Form -->
        <Panel headerText="Demand Details" class="sapUiResponsiveMargin" expandable="false">
            <VBox class="sapUiSmallMargin">
                <HBox width="100%">
                    <!-- Left Column -->
                    <VBox width="50%" class="sapUiSmallMarginEnd">
                        <f:SimpleForm
                            layout="ResponsiveGridLayout"
                            editable="true"
                            labelSpanL="3"
                            labelSpanM="3"
                            adjustLabelSpan="false"
                            emptySpanL="1"
                            emptySpanM="1"
                            columnsL="1"
                            columnsM="1"
                            class="sapUiNoContentPadding">
                            <!-- ✅ Removed Demand ID field - it's auto-generated by backend -->
                            <!-- ✅ Removed Project field - it's pre-selected from navigation and not needed in form -->
                            
                            <Label text="Skill" />
                            <MultiComboBox 
                                id="inputSkill_demand" 
                                width="100%" 
                                placeholder="Select skill"
                                items="{
                                    path: '/Skills',
                                    templateShareable: false
                                }">
                                <core:Item key="{name}" text="{name}" />
                            </MultiComboBox>
                            
                            <Label text="Quantity" />
                            <Input id="inputQuantity_demand" value="{demandModel>/quantity}" width="100%" type="Number" />
                        </f:SimpleForm>
                    </VBox>
                    
                    <!-- Right Column -->
                    <VBox width="50%" class="sapUiSmallMarginBegin">
                        <f:SimpleForm
                            layout="ResponsiveGridLayout"
                            editable="true"
                            labelSpanL="3"
                            labelSpanM="3"
                            adjustLabelSpan="false"
                            emptySpanL="1"
                            emptySpanM="1"
                            columnsL="1"
                            columnsM="1"
                            class="sapUiNoContentPadding">
                            <Label text="Band" />
                                    <Select id="inputBand_demand" selectedKey="{demandModel>/band}" width="100%">
                                        <items>
                                            <core:Item key="" text="Select Band..." />
                                            <core:Item key="1" text="1" />
                                            <core:Item key="2" text="2" />
                                            <core:Item key="3" text="3" />
                                            <core:Item key="4A" text="4A" />
                                            <core:Item key="4B-C" text="4B-C" />
                                            <core:Item key="4B-LC" text="4B-LC" />
                                            <core:Item key="4C" text="4C" />
                                            <core:Item key="4D" text="4D" />
                                            <core:Item key="5A" text="5A" />
                                            <core:Item key="5B" text="5B" />
                                            <core:Item key="Subcon" text="Subcon" />
                                        </items>
                                    </Select>
                        </f:SimpleForm>
                    </VBox>
                </HBox>
                
                <!-- Buttons Row -->
                <HBox class="sapUiMediumMarginTop" justifyContent="Center" width="100%">
                    <Button id="editButton_demand" text="Edit" type="Emphasized" press="onEditDemandForm" enabled="false" class="sapUiSmallMarginEnd" />
                    <Button id="saveButton_demand" text="Save" type="Emphasized" press="onSubmitDemand" class="sapUiSmallMarginEnd" />
                    <Button id="cancelButton_demand" text="Cancel" press="onCancelDemandForm" />
                </HBox>
            </VBox>
        </Panel>
    </VBox>
</core:FragmentDefinition>
